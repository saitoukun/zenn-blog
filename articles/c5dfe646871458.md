---
publication_name: "geniee"
title: "document.write()ã‚’å®Ÿè¡Œã™ã‚‹ã¨ä½•ãŒèµ·ã“ã‚‹ã®ã‹"
emoji: "ğŸ—‚"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: []
published: false
---

## æ¦‚è¦
`document.write()`ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€æ¬¡ã®ã‚ˆã†ãªå½±éŸ¿ãŒã‚ã‚Šã¾ã™ã€‚
- ä½é€Ÿç’°å¢ƒã«ãŠã„ã¦å¤§ããªé…å»¶ã‚’å¼•ãèµ·ã“ã™å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚
- `document.write()`ã«ã‚ˆã£ã¦è¿½åŠ ã•ã‚ŒãŸ`<script>`ã®èª­ã¿è¾¼ã¿ã‚’ç„¡è¦–ã•ã‚Œã‚‹äº‹ãŒã‚ã‚‹ã€‚

## å‚è€ƒã¨ãªã‚‹å„æƒ…å ±

### HTML è§£æãƒ—ãƒ­ã‚»ã‚¹

[HTML Living Standard: overview-of-the-parsing-model](https://html.spec.whatwg.org/multipage/parsing.html#overview-of-the-parsing-model)

### HTML Living Standardã®èª¬æ˜

> this method can affect the state of the HTML parser while the parser is running, resulting in a DOM that does not correspond to the source of the document

> ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã€ãƒ‘ãƒ¼ã‚µãƒ¼ã®å®Ÿè¡Œä¸­ã« HTML ãƒ‘ãƒ¼ã‚µãƒ¼ã®çŠ¶æ…‹ã«å½±éŸ¿ã‚’åŠã¼ã—ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã‚½ãƒ¼ã‚¹ã«å¯¾å¿œã—ãªã„ DOM ãŒç”Ÿæˆã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚


### MDNã®èª¬æ˜
> Chrome 55 ã‹ã‚‰ã¯ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œã¦ã„ãªã„ HTTP ã®å ´åˆã€document.write() ã‚’é€šã˜ã¦æŒ¿å…¥ã•ã‚ŒãŸ `<script>` è¦ç´ ã¯å®Ÿè¡Œã•ã‚Œãªããªã‚Šã¾ã™ã€‚ã“ã‚ŒãŒæˆç«‹ã™ã‚‹ã®ã«å¿…è¦ãªæ¡ä»¶ã®ä¸€è¦§ã«ã¤ã„ã¦ã¯ã€document.write() ã«å¯¾ã™ã‚‹ä»‹å…¥ã‚’ã”è¦§ãã ã•ã„ã€‚
> 
[MDN Document.write()](https://developer.mozilla.org/ja/docs/Web/API/Document/write)


### googleã®èª¬æ˜
> Using document.write() can delay the display of page content by tens of seconds and is particularly problematic for users on slow connections. 

document.write() ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ãƒšãƒ¼ã‚¸ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è¡¨ç¤ºãŒæ•°åç§’é…ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã€æ¥ç¶šãŒé…ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¨ã£ã¦ã¯ç‰¹ã«å•é¡Œã«ãªã‚Šã¾ã™ã€‚

[Chrome Developers no-document-write](https://developer.chrome.com/docs/lighthouse/best-practices/no-document-write/)

> - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ¥ç¶šãŒé…ã„å ´åˆ
> - document.write() ãŒãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå†…ã«ã‚ã‚‹å ´åˆ
> - document.write() å†…ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒãƒ‘ãƒ¼ã‚µãƒ¼ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹å ´åˆ
> - ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒåŒã˜ãƒ›ã‚¹ãƒˆã§ã¯ãªã„å ´åˆ
> - ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒãƒ–ãƒ©ã‚¦ã‚¶ã® HTTP ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ã¾ã å­˜åœ¨ã—ã¦ã„ãªã„å ´åˆ
> - ãƒªãƒ­ãƒ¼ãƒ‰ã§ã¯ãªã„å ´åˆ
ã¨ã„ã£ãŸæ¡ä»¶ã®ã‚‚ã¨ã€`<script>`ãŒç„¡è¦–ã•ã‚Œã‚‹å ´åˆãŒã‚ã‚‹ã€‚
[Chrome Developers Intervening against document.write()](https://developer.chrome.com/blog/removing-document-write/)

### Chromium (WIP)
Chromiumã®ã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚“ã§ã¿ã‚‹ã¨ç†è§£ãŒæ·±ã¾ã‚‹ã¯ãšã€‚WIP

https://www.chromium.org/Home/
https://www.chromium.org/developers/how-tos/getting-around-the-chrome-source-code/

ã“ã®è¾ºã‹ãª
https://source.chromium.org/chromium/chromium/src/+/main:third_party/blink/renderer/core/dom/document.cc;l=4276;bpv=1;bpt=0

https://source.chromium.org/chromium/chromium/src/+/main:third_party/blink/renderer/core/script/document_write_intervention.cc?q=%22via%20document.write%22&ss=chromium%2Fchromium%2Fsrc

### 

https://github.com/WICG/interventions/issues/17#issuecomment-238477265

## ã¾ã¨ã‚
ã¨ã„ã†ã‚ã‘ã§ã€`document.write()`ã¯ãƒ‘ãƒ¼ã‚µãƒ¼ãƒ¬ãƒ™ãƒ«ã§å½±éŸ¿ãŒã‚ã‚‹ã€‚

HTMLã®æ¨™æº–æ–‡æ›¸ã‹ã‚‰ã‚‚ã‚ã‹ã‚‹é€šã‚Šã€`user agent`(ãƒ–ãƒ©ã‚¦ã‚¶)ã¯ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãŒé…ã„å ´åˆã‚„ãƒšãƒ¼ã‚¸ã®èª­ã¿è¾¼ã¿ã«é•·ã„æ™‚é–“ãŒã‹ã‹ã£ã¦ã„ã‚‹å ´åˆã€`document.write()`çµŒç”±ã§è¿½åŠ ã•ã‚ŒãŸã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œã‚’ã—ãªãã¦ã‚‚ã„ã„ã“ã¨ã«ãªã£ã¦ã„ã‚‹ã€‚ã¾ãŸã€ä¸€éƒ¨ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ãã‚‚ãã‚‚å®Ÿè¡Œã—ãªã„ã€‚

ã‚ã¡ã‚ƒå¤ã„Androidç«¯æœ«ã¨ã‹ã¯ç‰¹ã«å®Ÿè¡Œã•ã‚Œãªã‹ã£ãŸã‚Šã™ã‚‹ã€‚